# TLConverter

Алгоритмы программы
Для работы программы было создано множество функций, как основных, так и вспомогательных. Также в программе имеются группы кода, не являющиеся функциями, что нужны для обработки нажатий на панели уведомлений. Рассмотрим подробно основные функции программы:

1.	Функция выполнения процесса вставки
Работа программы начинается в тот момент, когда пользователь вставляет в CKEditor текст, при этом активируется функция обрабатывающая данную процедуру «performPasting(evtData)», которой необходимо передать вставленные данные. Сперва делается копия первоначальных данных, чтобы была возможность повторно произвести все операции после смены настроек. Далее с помощью вспомогательной функции «getNumOfParagraphs(text)» находится общее количество параграфом, которое будет нужно потом для замены размера и стиля текста. После этого идет функция основной обработки HTML кода, что мы рассмотрим далее. Напоследок сменяется режим редактора на «source», деактивируется уведомление первого состояния и активируется уведомления второго состояния. Блок-схема функции представлена на рисунке 3.

2.	Функция обработки HTML кода
Первым делом с помощью вспомогательной группирующей функции «replaceEssentialStuff()», используя метод «replace», производится основная замена того, что было описано в техническом задание. После этого поочередно проверяется, включены ли переключатели «Size» и «Font», в правдивом случае запуская функции «replaceMostFrequentSize()» и «replaceMostFrequentFont()» соответственно. Далее активируется функция «replaceTrashSpans()», подчищающая бесполезные пустые тэги <span>. После замены происходит автоматическое копирование в буфер обмена с помощью вспомогательной функции «copyStringToClipboard(str)» [5], при активированном переключателе «Auto». И в конце функция присваивает редактору CKEditor измененные данные.

3.	Функции замены наиболее часто встречающегося размера и стиля
В данном разделе будет рассмотрена только функция «replaceMostFrequentSize()», так как она принципиально аналогична функции «replaceMostFrequentFont()», а единственным отличием являются данные для поиска с помощью регулярных выражений.
Сперва создается переменная хранящая регулярное выражение для поиска значения размера, которое на следующей строчке используется для создания массива из всех подобных значений. Если данный массив не равен нулю, то есть имеется форматирование, замена продолжается. С помощью вспомогательной функции «getMode(array)» [6] находится наиболее часто встречающееся значение «mode» из массива значение «arrayOfSizes». С его помощью создается регулярное выражение для проведения замены, что, используя метод «replace», проходит на следующей строчке. После этого сравнивается общее количество параграфов и количество наиболее часто встречающихся значений, полученных с помощью вспомогательной функции «getNumOfMode(array, mode)», при равенстве которых описанная здесь замена проводится с самого начала.

4.	Функция замены бесполезных тэгов «span»
Для работы данной функции нужно объявить переменную «currentPosition» для отслеживания позиции прохода проверки по тэгам «<span>». И переменные «closingPosition» для нахождения положения закрывающего тэга «</span>», «interimPosition» для отслеживания положения не пустого тэга «<span », располагающегося после «currentPosition» и до «closingPosition». А также добавлена константа «lenghtOfClosingSpan» для хранения длины закрывающего тэга «</span>».
Функции с помощью цикла whilt, пока после «currentPosition» встречаются пустые тэги «<span>», проходится по ним и при итерации для каждого непустого существующего тэга «<span» между «currentPosition» и его искомой «closingPosition» отодвигает «closingPosition» к следующему встречающемуся тэгу «</span>», до тех пор, пока между «currentPosition» и «closingPosition» не останется непарных открывающих и закрывающих тэгов span. С помощью метода «slice» найденные закрывающие тэги удаляются и цикл переходит к следующей итерации. После выполнения цикла методом «replace» удаляются все пустые открывающие тэги.